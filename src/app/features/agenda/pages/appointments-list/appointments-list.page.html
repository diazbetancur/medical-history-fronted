<div class="appointments-container">
  <header class="page-header">
    <h1>Mis Citas</h1>
    <button mat-raised-button color="primary" (click)="bookNewAppointment()">
      <mat-icon>add</mat-icon>
      Nueva Cita
    </button>
  </header>

  <!-- Loading State -->
  @if (loading()) {
  <div class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Cargando citas...</p>
  </div>
  }

  <!-- Error State -->
  @if (error() && !loading()) {
  <mat-card class="error-card">
    <mat-card-content>
      <mat-icon color="warn">error</mat-icon>
      <p>{{ error() }}</p>
      <button mat-button color="primary" (click)="loadAppointments()">
        Reintentar
      </button>
    </mat-card-content>
  </mat-card>
  }

  <!-- Empty State -->
  @if (!loading() && !error() && appointments().length === 0) {
  <mat-card class="empty-state">
    <mat-card-content>
      <mat-icon>event_busy</mat-icon>
      <h2>No tienes citas pr√≥ximas</h2>
      <p>Agenda tu primera cita con un profesional</p>
      <button mat-raised-button color="primary" (click)="bookNewAppointment()">
        <mat-icon>add</mat-icon>
        Agendar Cita
      </button>
    </mat-card-content>
  </mat-card>
  }

  <!-- Appointments List -->
  @if (!loading() && !error() && appointments().length > 0) {
  <div class="appointments-list">
    @for (appointment of appointments(); track appointment.id) {
    <mat-card class="appointment-card">
      <mat-card-header>
        <div class="appointment-header">
          <div class="professional-info">
            <mat-icon>person</mat-icon>
            <div>
              <h3>
                {{ appointment.professional.firstName }} {{
                appointment.professional.lastName }}
              </h3>
              @if (appointment.professional.specialization) {
              <p class="specialization">
                {{ appointment.professional.specialization }}
              </p>
              }
            </div>
          </div>

          <mat-chip [color]="getStatusColor(appointment.status)">
            {{ getStatusText(appointment.status) }}
          </mat-chip>
        </div>
      </mat-card-header>

      <mat-card-content>
        <div class="appointment-details">
          <div class="detail-item">
            <mat-icon>schedule</mat-icon>
            <span>{{ toLocalTime(appointment.startTime) }}</span>
          </div>

          @if (appointment.notes) {
          <div class="detail-item">
            <mat-icon>note</mat-icon>
            <span>{{ appointment.notes }}</span>
          </div>
          }
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button (click)="viewDetails(appointment.id)">
          <mat-icon>info</mat-icon>
          Ver Detalles
        </button>

        @if (appointment.status === 'confirmed' || appointment.status ===
        'pending') {
        <button mat-button (click)="exportToCalendar(appointment.id)">
          <mat-icon>download</mat-icon>
          Exportar
        </button>
        }
      </mat-card-actions>
    </mat-card>
    }
  </div>
  }
</div>
