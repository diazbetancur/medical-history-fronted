<div class="roles-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <div class="header-title">
          <mat-icon>shield</mat-icon>
          <h1>Gesti贸n de Roles</h1>
        </div>
      </mat-card-title>
      <mat-card-subtitle>
        Administra roles y sus permisos de acceso al sistema
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Stats Summary -->
      <div class="stats-row">
        <div class="stat-card">
          <mat-icon>category</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ totalRoles() }}</span>
            <span class="stat-label">Total Roles</span>
          </div>
        </div>
        <div class="stat-card">
          <mat-icon>verified_user</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ systemRoles().length }}</span>
            <span class="stat-label">Roles del Sistema</span>
          </div>
        </div>
        <div class="stat-card">
          <mat-icon>edit</mat-icon>
          <div class="stat-info">
            <span class="stat-value">{{ customRoles().length }}</span>
            <span class="stat-label">Roles Personalizados</span>
          </div>
        </div>
      </div>

      <!-- Actions Bar -->
      <div class="actions-bar">
        @if (canCreate()) {
        <button mat-raised-button color="primary" (click)="openCreateDialog()">
          <mat-icon>add</mat-icon>
          Crear Rol
        </button>
        }
      </div>

      <!-- Error Message -->
      @if (error()) {
      <div class="error-banner">
        <mat-icon>error</mat-icon>
        <span>{{ error() }}</span>
      </div>
      }

      <!-- Loading State -->
      @if (loading()) {
      <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Cargando roles...</p>
      </div>
      }

      <!-- Roles Table -->
      @if (!loading() && roles().length > 0) {
      <div class="table-container">
        <table mat-table [dataSource]="roles()" class="roles-table">
          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef>Nombre del Rol</th>
            <td mat-cell *matCellDef="let role">
              <div class="role-name-cell">
                <mat-icon class="role-icon">admin_panel_settings</mat-icon>
                <span class="role-name">{{ role.name }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Description Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef>Descripci贸n</th>
            <td mat-cell *matCellDef="let role">
              @if (role.description) {
              <span class="description-text">{{ role.description }}</span>
              } @if (!role.description) {
              <span class="no-description">Sin descripci贸n</span>
              }
            </td>
          </ng-container>

          <!-- Type Column -->
          <ng-container matColumnDef="type">
            <th mat-header-cell *matHeaderCellDef>Tipo</th>
            <td mat-cell *matCellDef="let role">
              <mat-chip [color]="getRoleTypeChip(role.isSystem).color">
                {{ getRoleTypeChip(role.isSystem).label }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td mat-cell *matCellDef="let role">
              <div class="actions-cell">
                <!-- Manage Permissions -->
                @if (canManagePermissions()) {
                <button
                  mat-icon-button
                  (click)="managePermissions(role)"
                  matTooltip="Gestionar permisos"
                  color="primary"
                >
                  <mat-icon>key</mat-icon>
                </button>
                }

                <!-- Edit Role -->
                @if (canEditRole(role)) {
                <button
                  mat-icon-button
                  (click)="openEditDialog(role)"
                  [matTooltip]="role.isSystem ? 'Editar descripci贸n (nombre protegido)' : 'Editar rol'"
                >
                  <mat-icon>edit</mat-icon>
                </button>
                } @else {
                <button
                  mat-icon-button
                  disabled
                  matTooltip="No tienes permisos para editar"
                >
                  <mat-icon>edit</mat-icon>
                </button>
                }

                <!-- Delete Role -->
                @if (canDeleteRole(role)) {
                <button
                  mat-icon-button
                  (click)="deleteRole(role)"
                  matTooltip="Eliminar rol"
                  color="warn"
                >
                  <mat-icon>delete</mat-icon>
                </button>
                } @else if (role.isSystem) {
                <button
                  mat-icon-button
                  disabled
                  matTooltip="Los roles del sistema no se pueden eliminar"
                >
                  <mat-icon>delete</mat-icon>
                </button>
                } @else {
                <button
                  mat-icon-button
                  disabled
                  matTooltip="No tienes permisos para eliminar"
                >
                  <mat-icon>delete</mat-icon>
                </button>
                }
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
      }

      <!-- Empty State -->
      @if (!loading() && roles().length === 0 && !error()) {
      <div class="empty-state">
        <mat-icon>shield_outline</mat-icon>
        <h3>No hay roles configurados</h3>
        <p>Crea un nuevo rol para comenzar a gestionar permisos</p>
        @if (canCreate()) {
        <button mat-raised-button color="primary" (click)="openCreateDialog()">
          <mat-icon>add</mat-icon>
          Crear Primer Rol
        </button>
        }
      </div>
      }
    </mat-card-content>

    <mat-card-actions>
      <button mat-button (click)="loadRoles()" [disabled]="loading()">
        <mat-icon>refresh</mat-icon>
        Actualizar
      </button>
    </mat-card-actions>
  </mat-card>
</div>
