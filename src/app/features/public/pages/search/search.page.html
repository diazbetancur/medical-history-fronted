<app-public-header></app-public-header>

<div class="search-container">
  <section class="search-hero">
    <h1>Buscar Médicos</h1>
    <p>Encuentra al especialista ideal para tu consulta</p>
  </section>

  <section class="filters-section">
    <mat-card class="filters-card">
      <div class="filters-row">
        <mat-form-field appearance="outline" class="filter-field search-field compact-field">
          <mat-label>Buscar por nombre o servicio</mat-label>
          <input
            matInput
            [formControl]="searchControl"
            [matAutocomplete]="nameAuto"
            placeholder="Escribe mínimo 3 letras"
            (keyup.enter)="onSearchClick()"
          />
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <mat-autocomplete #nameAuto="matAutocomplete" (optionSelected)="selectSuggestion($event.option.value)">
          @for (item of suggestions(); track item) {
            <mat-option [value]="item">{{ item }}</mat-option>
          }
        </mat-autocomplete>

        <mat-form-field appearance="outline" class="filter-field compact-field">
          <mat-label>Especialidad</mat-label>
          <mat-select [formControl]="specialtyControl">
            <mat-option [value]="null">Todas</mat-option>
            @for (specialty of specialties(); track specialty.id) {
              <mat-option [value]="specialty.slug">{{ specialty.name }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field compact-field">
          <mat-label>Ubicación (Ciudad)</mat-label>
          <mat-select [formControl]="cityControl">
            <mat-option [value]="null">Todas</mat-option>
            @for (city of cities(); track city.id) {
              <mat-option [value]="city.slug">{{ city.name }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <button mat-flat-button color="primary" class="search-btn" (click)="onSearchClick()">
          Buscar
        </button>
      </div>
    </mat-card>
  </section>

  @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="44"></mat-spinner>
      <p>Cargando resultados...</p>
    </div>
  }

  @if (error(); as errorMessage) {
    <div class="error-container">
      <mat-icon>error_outline</mat-icon>
      <h2>Error en la búsqueda</h2>
      <p>{{ errorMessage }}</p>
      <button mat-stroked-button (click)="reload()">Reintentar</button>
    </div>
  }

  @if (!loading() && !error()) {
    <section class="results-section">
      <div class="results-header">
        <h2>Médicos disponibles</h2>
        @if (pagination(); as pageInfo) {
          <span>{{ pageInfo.totalItems }} resultados</span>
        }
      </div>

      @if (!hasResults()) {
        <div class="empty-state">
          <mat-icon>search_off</mat-icon>
          <p>No encontramos médicos con esos filtros.</p>
        </div>
      } @else {
        <div class="doctor-list">
          @for (doctor of professionals(); track doctor.id) {
            <mat-card class="doctor-card">
              <div class="doctor-photo">
                @if (doctor.profileImageUrl) {
                  <img [src]="doctor.profileImageUrl" [alt]="doctor.businessName" title="Foto del médico" />
                } @else {
                  <mat-icon>person</mat-icon>
                }
              </div>

              <div class="doctor-info">
                <h3>{{ doctor.businessName }}</h3>
                <p class="location">
                  <mat-icon>place</mat-icon>
                  {{ doctor.cityName }}
                </p>
                <p class="extra-line">
                  <!-- Experiencia pendiente de backend en SearchProfessional -->
                  @if (doctor.priceFrom) {
                    Valor consulta aprox: ${{ doctor.priceFrom }}
                  } @else {
                    Valor consulta aprox: por confirmar
                  }
                </p>
              </div>

              <div class="doctor-actions">
                <button mat-stroked-button color="primary" (click)="goToProfile(doctor.slug)">
                  Ver perfil
                </button>
              </div>
            </mat-card>
          }
        </div>

        @if (pagination(); as pageInfo) {
          @if (pageInfo.totalItems > pageInfo.pageSize) {
            <mat-paginator
              [length]="pageInfo.totalItems"
              [pageSize]="pageInfo.pageSize"
              [pageIndex]="pageInfo.currentPage - 1"
              [pageSizeOptions]="[10, 25, 50]"
              (page)="onPageChange($event)"
              showFirstLastButtons
            ></mat-paginator>
          }
        }
      }
    </section>
  }
</div>

<footer class="footer">
  <div class="container">
    <div class="footer-grid">
      <div class="footer-col">
        <h3 class="footer-title">MediTigo</h3>
        <p class="footer-description">
          Tu directorio médico de confianza. Conectando pacientes con los mejores profesionales de la salud.
        </p>
      </div>

      <div class="footer-col">
        <h4 class="footer-heading">Enlaces Rápidos</h4>
        <ul class="footer-links">
          <li><a routerLink="/">Inicio</a></li>
          <li><a routerLink="/search">Buscar Médicos</a></li>
          <li><a routerLink="/login">Iniciar Sesión</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4 class="footer-heading">Soporte</h4>
        <ul class="footer-links">
          <li><a href="#">Ayuda</a></li>
          <li><a href="#">Términos de Servicio</a></li>
          <li><a href="#">Política de Privacidad</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4 class="footer-heading">Contáctanos</h4>
        <ul class="footer-links">
          <li><a href="mailto:contacto@meditigo.com">contacto&#64;meditigo.com</a></li>
        </ul>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; {{ 2024 }} MediTigo. Todos los derechos reservados.</p>
    </div>
  </div>
</footer>
